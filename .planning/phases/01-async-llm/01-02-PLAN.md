---
phase: 01-async-llm
plan: 02
type: execute
---

<objective>
GUI 탭에 비동기 LLM 호출 적용

Purpose: chapters_tab, scenes_tab, image_prompts_tab에 비동기 호출과 진행 표시기 적용
Output: 모든 LLM 호출 탭이 GUI를 블로킹하지 않고 진행 상태 표시
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-async-llm/01-01-SUMMARY.md

**핵심 소스 파일:**
@gui/tabs/chapters_tab.py
@gui/tabs/scenes_tab.py
@gui/tabs/image_prompts_tab.py
@services/async_llm_wrapper.py
@gui/dialogs/progress_dialog.py

**의존성:**
- 01-01 완료 필요 (AsyncLLMWrapper, ProgressDialog, async 메서드)
</context>

<tasks>

<task type="auto">
  <name>Task 1: chapters_tab 비동기 적용</name>
  <files>gui/tabs/chapters_tab.py</files>
  <action>
`_generate_script()` 메서드를 비동기로 전환:

1. ProgressDialog import 추가
2. `_generate_script()` 메서드 수정:
   - 진행 다이얼로그 표시
   - `content_generator.generate_script_async()` 호출
   - 성공/실패 콜백에서 다이얼로그 닫기 및 결과 처리
   - 취소 버튼 클릭 시 작업 취소

패턴:
```python
def _generate_script(self):
    # 유효성 검사 (기존 코드 유지)
    ...

    # 진행 다이얼로그 표시
    progress = ProgressDialog(
        self.frame.winfo_toplevel(),
        title="대본 생성 중",
        message=f"챕터 {chapter_num} 대본을 생성하고 있습니다..."
    )

    def on_success(script):
        progress.close()
        if script:
            # 결과 처리 (기존 로직)
            ...

    def on_error(error):
        progress.close()
        messagebox.showerror("오류", f"대본 생성 중 오류 발생:\n{error}")

    # 비동기 호출
    self.content_generator.generate_script_async(
        chapter, synopsis, characters_info, previous_script,
        on_success=on_success,
        on_error=on_error
    )
```

주의사항:
- 기존 유효성 검사 로직 유지
- 결과 저장 로직을 on_success 콜백으로 이동
- 버튼 상태 관리 (생성 중 비활성화)
  </action>
  <verify>python main.py 실행 후 대본 탭에서 생성 버튼 클릭 시 GUI 멈추지 않음</verify>
  <done>chapters_tab에서 대본 생성이 비동기로 동작하고 진행 다이얼로그 표시됨</done>
</task>

<task type="auto">
  <name>Task 2: scenes_tab 비동기 적용</name>
  <files>gui/tabs/scenes_tab.py</files>
  <action>
`_generate_current_chapter()` 메서드를 비동기로 전환:

1. ProgressDialog import 추가 (이미 threading 있으면 재사용)
2. `_generate_current_chapter()` 수정:
   - 진행 다이얼로그 표시
   - `content_generator.generate_scenes_async()` 호출
   - 콜백에서 결과 처리

기존 `_generate_all_chapters()`는 이미 threading 사용 중이므로:
- 진행 다이얼로그만 추가하거나
- 기존 패턴 유지

패턴은 Task 1과 동일하게 적용.

주의사항:
- `_generate_scenes()` 내부 로직을 콜백으로 분리
- 파일 저장 로직도 콜백 내에서 실행
  </action>
  <verify>python main.py 실행 후 장면 탭에서 현재 챕터 생성 시 GUI 멈추지 않음</verify>
  <done>scenes_tab에서 장면 생성이 비동기로 동작하고 진행 다이얼로그 표시됨</done>
</task>

<task type="auto">
  <name>Task 3: image_prompts_tab 비동기 적용</name>
  <files>gui/tabs/image_prompts_tab.py</files>
  <action>
`_generate_image_prompts()` 메서드를 비동기로 전환:

1. ProgressDialog import 추가
2. 다중 캐릭터 처리를 위한 순차 비동기 패턴 적용:
   - 진행 다이얼로그에 현재 캐릭터 표시
   - 각 캐릭터별로 `generate_image_prompts_async()` 호출
   - 완료 후 다음 캐릭터로 이동
   - 모든 캐릭터 완료 시 다이얼로그 닫기

패턴 (순차 비동기):
```python
def _generate_image_prompts(self):
    characters = [...]  # 대상 캐릭터 리스트

    progress = ProgressDialog(...)

    def process_next(index):
        if index >= len(characters):
            progress.close()
            messagebox.showinfo("완료", "모든 프롬프트 생성 완료")
            return

        char = characters[index]
        progress.update_message(f"'{char['name']}' 프롬프트 생성 중... ({index+1}/{len(characters)})")

        def on_success(prompts):
            # 저장 처리
            ...
            # 다음 캐릭터
            process_next(index + 1)

        def on_error(error):
            # 에러 처리 후 다음으로 진행 또는 중단
            process_next(index + 1)

        self.content_generator.generate_image_prompts_async(
            char, synopsis, visual_age,
            on_success=on_success,
            on_error=on_error
        )

    process_next(0)
```

주의사항:
- 여러 캐릭터 처리 시 순차적으로 진행
- 한 캐릭터 실패해도 나머지 계속 진행
- 진행률 표시 (1/5, 2/5 등)
  </action>
  <verify>python main.py 실행 후 이미지 프롬프트 탭에서 생성 시 GUI 멈추지 않음</verify>
  <done>image_prompts_tab에서 프롬프트 생성이 비동기로 동작하고 진행 다이얼로그 표시됨</done>
</task>

</tasks>

<verification>
완료 전 확인사항:
- [ ] chapters_tab 비동기 적용 완료
- [ ] scenes_tab 비동기 적용 완료
- [ ] image_prompts_tab 비동기 적용 완료
- [ ] 모든 탭에서 생성 중 GUI 반응성 유지
- [ ] 진행 다이얼로그 정상 표시
- [ ] python main.py 실행 시 오류 없음
</verification>

<success_criteria>
- 3개 탭 모두 비동기 LLM 호출로 전환
- 생성 중 GUI가 멈추지 않음
- 진행 다이얼로그가 표시되고 상태 업데이트됨
- 기존 기능(결과 저장, 오류 처리) 정상 동작
- Phase 1 완료
</success_criteria>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>비동기 LLM 호출이 적용된 3개 탭</what-built>
  <how-to-verify>
    1. Run: python main.py
    2. 대본 탭에서 대본 생성 버튼 클릭
       - 진행 다이얼로그가 표시되는지 확인
       - GUI가 멈추지 않고 반응하는지 확인
    3. 장면 탭에서 현재 챕터 장면 생성 버튼 클릭
       - 진행 다이얼로그가 표시되는지 확인
    4. 이미지 프롬프트 탭에서 프롬프트 생성 버튼 클릭
       - 진행 다이얼로그에 캐릭터별 진행률이 표시되는지 확인
    5. 각 작업 완료 후 결과가 정상적으로 저장되는지 확인
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

<output>
완료 후 `.planning/phases/01-async-llm/01-02-SUMMARY.md` 생성:

# Phase 1 Plan 2: Tab Updates Summary

**GUI 탭에 비동기 LLM 호출 적용 완료**

## Accomplishments
- chapters_tab 비동기 전환
- scenes_tab 비동기 전환
- image_prompts_tab 비동기 전환
- 모든 탭에 진행 다이얼로그 적용

## Files Modified
- `gui/tabs/chapters_tab.py`
- `gui/tabs/scenes_tab.py`
- `gui/tabs/image_prompts_tab.py`

## Decisions Made
[실행 중 결정사항]

## Issues Encountered
[문제 및 해결방법]

## Next Phase Readiness
Phase 1 (Async LLM) 완료. Phase 2 (Undo/Redo) 진행 가능.
</output>
